var fastorder_ajax_timer;Event.observe(window,'load',(function(){}));function fastorder_searchResult(input_id){if($(input_id).value.length>=fastorder_minAutocomplete)
{var $autocomplete=$('fastorder_autocomplete_'+input_id.replace('fastorder-ref-',''));$autocomplete.update('<ul></ul>');$autocomplete.update('<div class="fastorder-wrap-close"><a href="javascript:void(0);" class="fastorder-close" onclick="$(\'fastorder_autocomplete_'+input_id.replace('fastorder-ref-','')+'\').hide();">Close</a></div>'+$autocomplete.innerHTML);$($autocomplete).getElementsBySelector('ul').each(function(elem){$(elem).update('<li class="loader">&nbsp;</li>');});$autocomplete.show();$autocomplete.style.display='block';var $keyword=$(input_id).value;var position=jQuery('#'+input_id).parent().parent().parent().index();new Ajax.Request(fastorder_ajax_url,{parameters:'sku='+$keyword,method:'post',evalJSON:true,onSuccess:function(transport,json){var data=transport.responseText.evalJSON(true);$($autocomplete).getElementsBySelector('ul').each(function(elem){$(elem).update('');});if(data.length>0)
{for(var i=0;i<data.length;i++)
{var $class='';if(i==0)$class='selected';$($autocomplete).getElementsBySelector('ul').each(function(elem){var nameProduct=data[i].name.toUpperCase();var nameSearch=$keyword.toUpperCase();var start1=nameProduct.indexOf(nameSearch);var end1=start1+nameSearch.length;var $keyword1=data[i].name.slice(start1,end1);var nameSku=data[i].sku.toUpperCase();var start2=nameSku.indexOf(nameSearch);var end2=start2+nameSearch.length;var $keyword2=data[i].sku.slice(start2,end2);$(elem).update($(elem).innerHTML+'<li class="'+$class+'">'+'<a rel="'+data[i].sku+'" href="javascript:void(0);" onclick="selectSku(this, \''+input_id.replace('fastorder-ref-','')+'\', \''+data[i].sku+'\',\''+position+'\');" data-fancybox-type="ajax">'+'<span class="product-image"><div class="animation"><img src="'+data[i].thumbnail+'" alt="" /></div></span>'+'<div class="product-info">'+'<span class="product-name">'+data[i].name.replace($keyword1,'<span class="ref-part">'+$keyword1+'</span>')+'</span><br>'+'<span class="product-sku">SKU#: '+data[i].sku.replace($keyword2,'<span class="ref-part">'+$keyword2+'</span>')+'</span><br>'+'</div>'+'<span class="product-price">'+data[i].price+'</span>'+'<span class="product-url no-display">'+data[i].url+'</span>'+'<span class="typeid no-display">'+data[i].typeid+'</span>'+'<span class="sku no-display">'+data[i].sku+'</span>'+'<span class="prodid no-display">'+data[i].prodid+'</span>'+'<span class="option no-display">'+data[i].option+'</span>'+'<div class="tierprice_group no-display">'+data[i].tierprices+'</div>'+'</a>'+'<div class="clear"></div>'+'</li>');});}
$($autocomplete).getElementsBySelector('ul li').each(function(elem){$(elem).observe('mouseover',function(){$($autocomplete).getElementsBySelector('ul li').each(function(all_li){$(all_li).removeClassName('selected');});$(elem).addClassName('selected');});});$($autocomplete).getElementsBySelector('ul li').each(function(elem){$(elem).observe('mouseout',function(){$(elem).removeClassName('selected');});});}
else
{$($autocomplete).getElementsBySelector('ul').each(function(elem){$(elem).update('<li class="fastorder-no-results">No result</li>');});}}});}}
function selectSku(elem,result_id,sku,position)
{var $autocomplete=$('fastorder_autocomplete_'+result_id);$autocomplete.hide();var $img;$(elem).getElementsBySelector('.product-image').each(function(img){$img=img.innerHTML;});var $name;$(elem).getElementsBySelector('.product-name').each(function(name){$name=name.innerHTML;});var $url;$(elem).getElementsBySelector('.product-url').each(function(url){$url=url.innerHTML;});var $price;$(elem).getElementsBySelector('.product-price').each(function(price){$price=price.innerHTML;});var $typeid;$(elem).getElementsBySelector('.typeid').each(function(typeid){$typeid=typeid.innerHTML;});var $sku;$(elem).getElementsBySelector('.sku').each(function(sku){$sku=sku.innerHTML;});var $prodid;$(elem).getElementsBySelector('.prodid').each(function(prodid){$prodid=prodid.innerHTML;});var $option;$(elem).getElementsBySelector('.option').each(function(option){$option=option.innerHTML;});var data='';if($typeid=='configurable'){data={product:$prodid,qty:1,row:result_id,position:position,fastorder:1};}
if($typeid!=='configurable'&&$option==1){data={product:$prodid,qty:1,row:result_id,position:position,no_configurable:1,fastorder:1};}
if(data){if(jQuery('.page .price-box .old-price #old-price-'+$prodid).length>0){jQuery('.page .price-box .old-price #old-price-'+$prodid).attr('id','fastorder-old-price-'+$prodid);jQuery('.page .price-box .old-price #old-price-'+$prodid+'_clone').attr('id','fastorder-old-price-'+$prodid+'_clone');}
if(jQuery('.page .tier-prices .price').length>0){jQuery('.page .tier-prices .price').attr('class','fastorder-price');}
jQuery.fancybox.showLoading();jQuery('.page .price-box #product-price-'+$prodid).attr('id','fastorder-product-price-'+$prodid);jQuery('.page .price-box #product-price-'+$prodid+'_clone').attr('id','fastorder-product-price-'+$prodid+'_clone');jQuery.ajax({cache:false,url:fastorder_ajax_cart_option,data:data,success:function(data){jQuery.fancybox(data,{'titlePosition':'inside','minWidth':'250px','transitionIn':'none','transitionOut':'none','height':'auto','autoSize':true,'closeClick':false,'helpers':{overlay:{closeClick:false},fixed:false,},'afterClose':(function(){if(jQuery('.page .price-box #fastorder-product-price-'+$prodid+'_clone').length>0){jQuery('.page .price-box #fastorder-product-price-'+$prodid+'_clone').attr('id','product-price-'+$prodid+'_clone');}
if(jQuery('.page .price-box #fastorder-product-price-'+$prodid).length>0){jQuery('.page .price-box #fastorder-product-price-'+$prodid).attr('id','product-price-'+$prodid);}
if(jQuery('.page .price-box .old-price #fastorder-old-price-'+$prodid+'_clone').length>0){jQuery('.page .price-box .old-price #fastorder-old-price-'+$prodid+'_clone').attr('id','old-price-'+$prodid+'_clone');}
if(jQuery('.page .price-box .old-price #fastorder-old-price-'+$prodid).length>0){jQuery('.page .price-box .old-price #fastorder-old-price-'+$prodid).attr('id','old-price-'+$prodid);}
if(jQuery('.page .tier-prices .fastorder-price').length>0){jQuery('.page .tier-prices .fastorder-price').attr('class','price');}}),});}});}
var $tierprice;$(elem).getElementsBySelector('.tierprice_group').each(function(tierprice){$tierprice=tierprice.innerHTML;});if($tierprice){$$('#fastorder-'+result_id+' .fastorder-row-qty .price_group').each(function(tierprice){$(tierprice).update($tierprice);});}
$$('#fastorder-'+result_id+' .fastorder-row-image').each(function(img){$(img).update($img);});$$('#fastorder-'+result_id+' .fastorder-row-name').each(function(name){$(name).update('<div><a class="animation" target="_blank" href="'+$url+'">'+$name+'</a>'+'<br><span class="reference"></span>'+$price+'</div><div class="row-loader"></div>');});$('fastorder-add-'+result_id).removeClassName('disabled');if($typeid=='configurable'||$option==1){$('fastorder-edit-'+result_id).removeClassName('disabled');}else{$('fastorder-edit-'+result_id).addClassName('disabled');}
$('fastorder-ref-'+result_id).value=sku;$$('#fastorder-'+result_id+' input.sku').each(function(input){$(input).value=sku;});$$('#fastorder-'+result_id+' input.typeid').each(function(input){$(input).value=$typeid;});$$('#fastorder-'+result_id+' .fastorder-row-image div.animation').each(function(animation){new Effect.Morph($(animation),{style:{left:'0px'},duration:0.5,afterFinish:function(){$$('#fastorder-'+result_id+' .fastorder-row-name div.animation').each(function(animation2){new Effect.Morph($(animation2),{style:{left:'0px'},duration:0.5});});}});});totalPrice(elem);}
function fastorder_manageArrow(elem_id,type)
{$autocomplete=$('fastorder_autocomplete_'+elem_id);var $elem;if(type=='down')
{if($($autocomplete).getElementsBySelector('ul li').length>0)
{$($autocomplete).getElementsBySelector('li.selected').each(function(li){$elem=li;});$($autocomplete).getElementsBySelector('ul li:last').each(function(elem){if($(elem).hasClassName('selected'))
{$($autocomplete).getElementsBySelector('ul li:first')[0].addClassName('selected');$($autocomplete).getElementsBySelector('ul li:last')[0].removeClassName('selected');}
else if($elem)
{$elem.removeClassName('selected');$elem.next().addClassName('selected');}});if(!$elem)
{$($autocomplete).getElementsBySelector('ul li:first')[0].addClassName('selected');}}}
else if(type=='up')
{if($($autocomplete).getElementsBySelector('ul li').length>0)
{$($autocomplete).getElementsBySelector('li.selected').each(function(li){$elem=li;});$($autocomplete).getElementsBySelector('ul li:first').each(function(elem){if($(elem).hasClassName('selected'))
{$($autocomplete).getElementsBySelector('ul li:first')[0].removeClassName('selected');$($autocomplete).getElementsBySelector('ul li:last')[0].addClassName('selected');}
else if($elem)
{$elem.removeClassName('selected');$elem.previous().addClassName('selected');}});if(!$elem)
{$($autocomplete).getElementsBySelector('ul li:last')[0].addClassName('selected');}}}}
function fastorder_manageEnterAndOkButton(elem_id)
{$id=elem_id.replace('fastorder-ref-','');if($$('#fastorder_autocomplete_'+$id+' ul li.selected').length>0)
{selectSku($$('#fastorder_autocomplete_'+$id+' ul li.selected a')[0],$id,$$('#fastorder_autocomplete_'+$id+' ul li.selected a')[0].readAttribute('rel'));}
else
{window.clearTimeout(fastorder_ajax_timer);fastorder_ajax_timer=window.setTimeout("fastorder_searchResult('"+elem_id+"')",500);}}
function fastorder_reset(id){$('fastorder-ref-'+id).value='';$$('#fastorder-'+id+' .fastorder-row-image')[0].update('&nbsp;');$$('#fastorder-'+id+' .fastorder-row-name')[0].update('&nbsp;');$$('#fastorder-'+id+' .fastorder-row-price')[0].update('<span class="price"></span>');$$('#fastorder-'+id+' input.qty')[0].value='1';$$('#fastorder-'+id+' input.sku')[0].value='';$$('#fastorder-'+id+' input.typeid')[0].value='';$('fastorder-add-'+id+'').addClassName('disabled');$('fastorder-edit-'+id+'').addClassName('disabled');}
function fastorder_resetAll(){jQuery('#fastorder_form').html(oldform);}
function fastorder_options(row,price,text,qty){jQuery('#fastorder-'+row).find('.reference').html(text);jQuery('#fastorder-'+row).find('.price').text(price);finalprice=price.replace(fastorder_currency,"");jQuery('#fastorder-'+row).find('.fastorder-row-qty .finalprice').val(finalprice);totalPrice(jQuery('#fastorder-'+row).find('.fastorder-row-qty .qty'));}
function fastorder_add_row_option(row1,row2,price,text,qty){var clone=jQuery('#fastorder-'+row1).clone();while(jQuery('#fastorder_form').find('#fastorder-'+row2).length>0){row2=row2/1+100;}
clone.attr('id','fastorder-'+row2);clone.find('#fastorder-ref-'+row1).attr('id','fastorder-ref-'+row2);clone.find('#fastorder-'+row1+'-search').attr('id','fastorder-'+row2+'-search');clone.find('#fastorder_autocomplete_'+row1).attr('id','fastorder_autocomplete_'+row2)
clone.find('#fastorder-add-'+row1).attr('id','fastorder-add-'+row2);clone.find('.reference').text(text);clone.find('.price').text(price);clone.find('input.qty').val(qty);clone.insertAfter('#fastorder-'+row1);}
function fastorder_create(){var length=jQuery('#fastorder .fastorder-multiple-form tbody > tr').length;var form1='<tr class="fastorder-row" id="fastorder-'+length+'">'+form+'</tr>';form1=form1.replace(/fastorder-ref-1/g,"fastorder-ref-"+length);form1=form1.replace(/fastorder-1-search/g,"fastorder-"+length+'-search');form1=form1.replace(/fastorder_autocomplete_1/g,"fastorder_autocomplete_"+length);form1=form1.replace(/fastorder-add-1/g,"fastorder-add-"+length);form1=form1.replace(/fastorder-edit-1/g,"fastorder-edit-"+length);jQuery('.fastorder-multiple-form').append(form1);}
function fastorder_submit_form(){jQuery('#fastorder .messages').empty();jQuery('.fastorder-multiple-form tr.row-loader-bg').css('opacity','0.5');jQuery.fancybox.showLoading();jQuery.ajax({type:jQuery('#fastorder_form').attr('method'),url:jQuery('#fastorder_form').attr('action'),data:{items:jQuery('form#fastorder_form').serialize()},success:function(msg){jQuery.fancybox.hideLoading();jQuery('.fastorder-multiple-form tr.row-loader-bg').css('opacity','1');var res=msg.evalJSON();if(res.success){jQuery('#fastorder .messages').append('<div class="success-msg">'+res.messagesuccess+'</div>');window.location.href=fastorder_checkout_cart;}else{jQuery('#fastorder .messages').append('<div class="error-msg">'+res.messageerror+'</div>');}},});}
jQuery(document).ready(function(){jQuery(document).on('click','.fastorder-row-image',function(){if(jQuery(this).parent().attr('id').replace('fastorder-','')!=0&&jQuery(this).children().length>0){var html=jQuery(this).children().html();jQuery('.fastorder-thumbnail-container').html(html);jQuery('.fastorder-thumbnail-container').css({width:'100%',height:'100%',position:'fixed','z-index':'2147483650','background-color':'rgba(53, 53, 53, 0.64)',display:'block',top:0,left:0});jQuery('.fastorder-thumbnail-container').children().css({width:'auto',height:'85%','z-index':'1000',margin:'0 auto',display:'block','margin-top':'2%'});};});jQuery(document).on('click','.fastorder-thumbnail-container',function(){jQuery(this).hide();})
jQuery(document).on('keydown','.fastorder-row-ref .input-text',function(e){if(e.keyCode==13)
{e.preventDefault();};});jQuery(document).on('keydown','.fastorder-row-qty .qty',function(e){if(e.keyCode==13)
{e.preventDefault();};});jQuery(document).on('keyup','.fastorder-row-ref .input-text',function(e){if(e.keyCode==13)
{fastorder_manageEnterAndOkButton(jQuery(this).attr('id'));}
if(e.keyCode==8||e.keyCode==46)
{window.clearTimeout(fastorder_ajax_timer);fastorder_ajax_timer=window.setTimeout("fastorder_searchResult('"+jQuery(this).attr('id')+"')",500);}
else if(e.keyCode==38)
{fastorder_manageArrow(jQuery(this).attr('id').replace('fastorder-ref-',''),'up');}
else if(e.keyCode==40)
{fastorder_manageArrow(jQuery(this).attr('id').replace('fastorder-ref-',''),'down');}
else if(e.keyCode==27)
{jQuery('fastorder_autocomplete_'+jQuery(this).attr('id').replace('fastorder-ref-','')).hide();}
else if('azertyuiopqsdfghjklmwxcvbnAZERTYUIOPQSDFGHJKLMWXCVBN1234567890'.indexOf(String.fromCharCode(e.keyCode))!=-1)
{window.clearTimeout(fastorder_ajax_timer);fastorder_ajax_timer=window.setTimeout("fastorder_searchResult('"+jQuery(this).attr('id')+"')",500);};if(!jQuery(this).val().length>=fastorder_minAutocomplete)
{jQuery(this).parent().next('.fastorder_autocomplete').hide();};});jQuery(document).on('click','.fastorder-row-add .btn-ok',function(){if(!jQuery(this).hasClass('disabled')){fastorder_reset(jQuery(this).attr('id').replace('fastorder-add-',''));}});jQuery(document).on('click','.fastorder-row-ref button',function(){if(!jQuery(this).hasClass('disabled'))
{fastorder_manageEnterAndOkButton(jQuery(this).prev().attr('id'));};});jQuery(document).on('change','#fastorder .fastorder-row-qty .qty',function(){jQuery('#fastorder_form .validation-advice').remove();var sku=jQuery(this).next().val();var typeid=jQuery(this).next().next().val();if(sku&&typeid){totalPrice(this);}});jQuery('.bss-fastorder').featherlight({loading:'<div id="fountainTextG"><div id="fountainTextG_1" class="fountainTextG">L</div><div id="fountainTextG_2" class="fountainTextG">o</div><div id="fountainTextG_3" class="fountainTextG">a</div><div id="fountainTextG_4" class="fountainTextG">d</div><div id="fountainTextG_5" class="fountainTextG">i</div><div id="fountainTextG_6" class="fountainTextG">n</div><div id="fountainTextG_7" class="fountainTextG">g</div></div>',root:'.wrapper',afterClose:function(event){optionsPrice=optionsPrice2;},beforeOpen:function(event){if(jQuery('.datetime-picker').length>0){jQuery('.datetime-picker').each(function(){jQuery(this).next().attr('id','');});}},});});function convertPrice(price){price=parseFloat(price).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,");return price;}
function totalPrice(e){var qty=jQuery(e).closest('.fastorder-row').find('.fastorder-row-qty .qty').val();total_1=jQuery(e).closest('.fastorder-row').find('.fastorder-row-name .price').text();finalprice=total_1.replace(fastorder_currency,"");finalprice=Number(finalprice.replace(/[^0-9\.]+/g,""));if(jQuery(e).parent().find('.price_group .tierprice').length>0){var i=0;jQuery(e).closest('.fastorder-row').find('.fastorder-row-qty .price_group').children('input').each(function(){tierprice=parseInt(jQuery(this).attr('data-qty'));if(qty<tierprice&&qty!=0){number=(jQuery(this).prev().val());return false;}
if(qty>=tierprice&&qty!=0&&!jQuery(this).next().attr('data-qty')){number=(jQuery(this).val());return false;}
i++;});}else{number=finalprice;}
total_2=parseInt(qty)*number;total=fastorder_currency+convertPrice(total_2);jQuery(e).closest('.fastorder-row').find('.fastorder-row-price .price').text(total);jQuery(e).closest('.fastorder-row').find('.fastorder-row-qty .price_group .finalprice').val(finalprice);}
function editConfigurable(e){sku=jQuery(e).parent().parent().find('.fastorder-row-qty .sku').val();jQuery(e).parent().parent().find('.fastorder_autocomplete a').each(function(){if(jQuery(this).attr('rel')==sku){jQuery(this).click();}});}
function importCsv(e){jQuery('#fastorder .messages').empty();var formImport=e.target
var formData=new FormData(formImport);jQuery.ajax({url:jQuery("form#data").attr('action'),type:'POST',data:formData,cache:false,contentType:false,processData:false,success:function(data){if(!data){jQuery('#fastorder .messages').append('<div class="error-msg">Need SKU column.</div>');}else{jQuery.each(jQuery.parseJSON(data),function(){var length=jQuery('#fastorder .fastorder-multiple-form > div').length;for(var j=1;j<length;j++){var target2='#fastorder-'+j;sku2=jQuery(target2).find('.fastorder-row-qty .sku').val();typeid2=jQuery(target2).find('.fastorder-row-qty .typeid').val();if(sku2==this.sku&&typeid2==this.typeid){qtyOld=jQuery(target2).find('.fastorder-row-qty .qty').val();if(this.qty){qtyUpdate=parseInt(this.qty);}else{qtyUpdate=1;}
qtyNew=qtyUpdate+parseInt(qtyOld);jQuery(target2).find('.fastorder-row-qty .qty').val(qtyNew);totalPrice(jQuery(target2).find('.fastorder-row-qty .qty'));return;}}
for(var i=1;;i++){var target='#fastorder-'+i;if(jQuery(target).length==0){fastorder_create();}
sku=jQuery(target).find('.fastorder-row-qty .sku').val();typeid=jQuery(target).find('.fastorder-row-qty .typeid').val();if(sku==''&&typeid==''){break;}}
var autocomplete='#fastorder_autocomplete_'+i;position=jQuery('#fastorder-ref-'+i).parent().parent().parent().index();jQuery(autocomplete).find('ul').replaceWith('<ul><li>'+'<a rel="'+this.sku+'" href="javascript:void(0);" onclick="selectSku(this, \''+i+'\', \''+this.sku+'\',\''+position+'\');">'+'<span class="product-image"><div class="animation"><img src="'+this.thumbnail+'" alt="" /></div></span>'+'<span class="product-name">'+this.name+'</span><br>'+'<span class="product-price">'+this.price+'</span>'+'<span class="product-url no-display">'+this.url+'</span>'+'<span class="typeid no-display">'+this.typeid+'</span>'+'<span class="sku no-display">'+this.sku+'</span>'+'<span class="prodid no-display">'+this.prodid+'</span>'+'<span class="option no-display">'+this.option+'</span>'+'</a>'+'<div class="clear"></div>'+'</li></ul>');qty=parseInt(this.qty);if(qty){jQuery(target).find('.fastorder-row-qty .qty').val(qty);totalPrice(jQuery(target).find('.fastorder-row-qty .qty'));}
var select='#fastorder_autocomplete_'+i;jQuery(select).each(function(){jQuery(this).find('li:first a').click();});});}}});return false;}